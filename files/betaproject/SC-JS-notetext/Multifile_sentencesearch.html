
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>[MFSS] Multifile sentence search / File Merger & Search Tool</title>
<style>
  body {
    font-family: sans-serif;
    margin: 1rem auto;
    max-width: 850px;
    line-height: 1.5;
    color: #222;
  }
  h2, h3 { margin-top: 1rem; }
  button {
    cursor: pointer;
    border: none;
    padding: 4px 10px;
    border-radius: 4px;
    background: #3498db;
    color: #fff;
    font-size: 0.85rem;
    margin: 2px;
  }
  button:hover { background: #2980b9; }
  input[type="text"], textarea {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px;
    width: 100%;
    font-family: monospace;
    font-size: 0.9rem;
  }
  textarea { min-height: 100px; }
  .file-block {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0.5rem;
    margin: 0.4rem 0;
    background: #fafafa;
  }
  #resultList li {
    margin: 0.3rem 0;
    padding: 0.4rem;
    border: 1px solid #eee;
    border-radius: 4px;
    background: #fff;
  }
  #resultList li.faded { opacity: 0.5; }
  sub {
    display: block;
    margin-top: 0.3rem;
    color: #555;
    font-style: italic;
    font-size: 0.8rem;
  }
  #searchContainer { margin: 1rem 0; }
  #searchInput { width: 70%; display: inline-block; margin-right: 0.5rem; }
  .sent-idx {
  color: #999;
  font-size: 0.8rem;
  margin-right: 0.5rem;
}

/* overlay */
.popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.popup-overlay.hidden {
  display: none;
}

/* box */
.popup-content {
  background: #fff;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  position: relative;
  font-family: sans-serif;
}

/* close btn */
.popup-close {
  position: absolute;
  top: 8px;
  right: 12px;
  font-size: 1.5rem;
  border: none;
  background: none;
  cursor: pointer;
}

/* sentence */
#popupSentence {
  font-size: 1rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  white-space: pre-wrap;
}

/* nav buttons */
.popup-nav {
  display: flex;
  justify-content: space-between;
}
.popup-nav button {
  padding: 0.5rem 1rem;
  border: none;
  background: #007acc;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}
.popup-nav button:hover {
  background: #005fa3;
}


</style>

</head>
<body>
<div id="tutorialBox" style="border:1px solid #ccc; padding:0.8rem; margin:1rem 0; border-radius:6px; background:#f9f9f9;">
  <button id="toggleLang" style="float:right;">EN</button>
  <div id="tutorialContent"></div>
</div>

<script>
  const tutorial = {
    id: `
      <h3>Tutorial (Bahasa Indonesia)</h3>
      <ol>
        <li><b>Pemasukan File:</b> Klik <i>Add File</i>, pilih file, opsional beri judul. Klik <i>Merge</i> untuk menggabungkan isi ke textarea.</li>
        <li><b>Pemotongan Kalimat:</b> Pilih metode pemisah (koma, titik, baris, simbol, angka, custom). Klik <i>Submit</i> untuk memecah menjadi potongan kalimat.</li>
        <li><b>Pencarian:</b> Masukkan keyword.  
            Gunakan <code>+</code> untuk semua kata, <code>-</code> untuk mengecualikan, <code>/</code> untuk tambahkan hasil lain.</li>
        <li><b>Label & Komentar:</b>  
            - <i>Label</i> = tandai item dengan warna biru  
            - <i>Fade</i> = redupkan item  
            - <i>Comment</i> = tambahkan catatan di bawah item  
        </li>
      </ol>
    `,
    en: `
      <h3>Tutorial (English)</h3>
      <ol>
        <li><b>File Input:</b> Click <i>Add File</i>, choose file, optionally add title. Click <i>Merge</i> to combine contents into textarea.</li>
        <li><b>Sentence Cutting:</b> Choose separators (comma, dot, newline, symbols, numbers, custom). Click <i>Submit</i> to split into sentences.</li>
        <li><b>Search:</b> Enter keyword.  
            Use <code>+</code> for AND, <code>-</code> to exclude, <code>/</code> to add extra matches.</li>
        <li><b>Label & Comment:</b>  
            - <i>Label</i> = mark with blue highlight  
            - <i>Fade</i> = dim the item  
            - <i>Comment</i> = add a note under the item  
        </li>
      </ol>
    `
  };
  let lang = "id";
  function renderTut() {
    document.getElementById("tutorialContent").innerHTML = tutorial[lang];
    document.getElementById("toggleLang").textContent = lang === "id" ? "EN" : "ID";
  }
  document.getElementById("toggleLang").addEventListener("click", () => {
    lang = (lang === "id") ? "en" : "id";
    renderTut();
  });
  renderTut();
</script>




<h2>Input Files</h2>
<div id="fileInputs"></div>
<button id="addFile">+ Add File</button>
<br><br>
<label><input type="radio" name="separator" value="dashed" checked> Dashed Line</label>
<label><input type="radio" name="separator" value="double"> Double Newline</label>
<label><input type="radio" name="separator" value="custom"> Custom:</label>
<input type="text" id="customSeparator" disabled placeholder="Custom sep (use $filetitle)">
<br>
<button id="mergeBtn">Merge Files</button>
<br><br>

<h3>Raw Text</h3>
<textarea id="textInput"></textarea>

<h2>Split Options</h2>
<label><input type="checkbox" id="sepComa" checked> , </label>
<label><input type="checkbox" id="sepPoint" checked> . </label>
<label><input type="checkbox" id="sepLines" checked> lines </label>
<label><input type="checkbox" id="sepSymbols"> symbols </label>
<label><input type="checkbox" id="sepChars"> chars </label>
<label><input type="checkbox" id="sepNumbers"> numbers </label>
<br>
Custom: <input type="text" id="customSep">
<br>
<button id="processBtn">Split</button>

<h2>Search</h2>
<input type="text" id="searchInput" placeholder="Search (+,-,/ keyword)">
<button id="searchBtn">Search</button>
<button id="toggleCaseBtn">Case: OFF</button>

<h3>Results:</h3>
<ol id="resultList"></ol>

<h3>Summary</h3>
<p><b>Labeled:</b> <span id="labelSummary"></span></p>
<p><b>Faded:</b> <span id="fadeSummary"></span></p>
<p><b>Commented:</b> <span id="commentSummary"></span></p>

<template id="fileInputTemplate">
  <div>
    <input type="file" class="fileInput">
    <input type="checkbox" class="includeCheck" checked> Include
    <input type="text" class="titleInput" placeholder="Optional title">
    <input type="checkbox" class="useTitle" checked> Add Title
    <button class="removeFile">Remove</button>
  </div>
</template>





<script>



const fileInputsContainer = document.getElementById("fileInputs");
function addFileInput() {
  fileInputsContainer.appendChild(document.getElementById("fileInputTemplate").content.cloneNode(true));
}
document.getElementById("addFile").addEventListener("click", addFileInput);
fileInputsContainer.addEventListener("click", e => {
  if (e.target.classList.contains("removeFile")) e.target.parentElement.remove();
});
addFileInput();

document.querySelectorAll('input[name="separator"]').forEach(r => {
  r.addEventListener("change", ()=> {
    document.getElementById("customSeparator").disabled = 
      (document.querySelector('input[name="separator"]:checked').value !== "custom");
  });
});

document.getElementById("mergeBtn").addEventListener("click", async () => {
  const blocks = document.querySelectorAll("#fileInputs > div");
  let results = [];
  for (let block of blocks) {
    const fileInput = block.querySelector(".fileInput");
    const include = block.querySelector(".includeCheck").checked;
    const title = block.querySelector(".titleInput").value.trim();
    const useTitle = block.querySelector(".useTitle").checked;
    if (fileInput.files[0] && include) {
      const text = await fileInput.files[0].text();
      const sepType = document.querySelector("input[name='separator']:checked").value;
      let separator = sepType==="dashed" ? "\n------------------\n"
                    : sepType==="double" ? "\n\n"
                    : "\n"+document.getElementById("customSeparator").value+"\n";
      let titleText = "";
      if (useTitle) {
        const effectiveTitle = title || fileInput.files[0].name;
        if (sepType==="custom") separator = "\n"+document.getElementById("customSeparator").value.replace(/\$filetitle/g,effectiveTitle)+"\n";
        else titleText = `\n[Title: ${effectiveTitle}]\n`;
      }
      results.push(titleText+text, separator);
    }
  }
  document.getElementById("textInput").value = results.join("");
});

// === Processing ===
let mainResults = [], caseSensitive=false;
function linearSplit(text, separators) {
  let parts=[text];
  separators.forEach(sep=>{
    let newParts=[];
    parts.forEach(chunk=>{
      let regex=new RegExp(`(${sep})`,"g");
      let split=chunk.split(regex);
      let cur="";
      split.forEach((piece,i)=>{
        cur+=piece;
        if(regex.test(piece)||i===split.length-1){newParts.push(cur.trim());cur="";}
      });
    });
    parts=newParts.filter(Boolean);
  });
  return parts;
}
function normalize(str){let s=caseSensitive?str:str.toLowerCase();return s;}
function parseSearchRules(rules){
  let queries=rules.trim().split(/\s+/).filter(Boolean);
  let results=[...mainResults.keys()];
  queries.forEach(q=>{
    if(q.includes('+')){
      let subs=q.split('+').filter(Boolean);
      results=results.filter(i=>subs.every(sq=>normalize(mainResults[i]).includes(normalize(sq))));
    } else if(q.startsWith('-')){
      results=results.filter(i=>!normalize(mainResults[i]).includes(normalize(q.slice(1))));
    } else if(q.startsWith('/')){
      mainResults.forEach((txt,idx)=>{if(normalize(txt).includes(normalize(q.slice(1)))&&!results.includes(idx))results.push(idx);});
    } else {
      results=results.filter(i=>normalize(mainResults[i]).includes(normalize(q)));
    }
  });
  return results;
}

function renderList(indices) {
  const list = document.getElementById("resultList");
  list.innerHTML = "";
  indices.forEach(idx => {
    let saved = loadState(idx);
    let li = document.createElement("li");
    li.dataset.index = idx;
    li.classList.toggle("faded", saved.fade);
    if (saved.label) li.style.backgroundColor = "lightblue";

    li.innerHTML = `
      <span class="sent-idx">[${idx}]</span> ${mainResults[idx]}
      <button class="btn-copy">Copy</button>
      <button class="btn-label">Label</button>
      <button class="btn-fade">Fade</button>
      <button class="btn-comment">Comment</button>
      <button class="btn-view">View</button>
    `;

    saved.comments.forEach(c =>
      li.insertAdjacentHTML("beforeend", `<sub>${c}</sub>`)
    );

    list.appendChild(li);
  });
  updateSummary();
}





document.getElementById("processBtn").addEventListener("click",()=>{
  const text=document.getElementById("textInput").value;
  let seps=[];
  if(document.getElementById("sepComa").checked) seps.push(",");
  if(document.getElementById("sepPoint").checked) seps.push("\\.");
  if(document.getElementById("sepLines").checked) seps.push("\\r?\\n");
  if(document.getElementById("sepSymbols").checked) seps.push("[^À-ža-zA-Z0-9\\s]");
  if(document.getElementById("sepChars").checked) seps.push("");
  if(document.getElementById("sepNumbers").checked) seps.push("\\d+");
  const c=document.getElementById("customSep").value.trim();
  if(c) seps.push(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));
  mainResults=seps.length?linearSplit(text,seps):[text];
  renderList(mainResults.map((_,i)=>i));
});

document.getElementById("searchBtn").addEventListener("click",()=>{
  renderList(parseSearchRules(document.getElementById("searchInput").value));
});
document.getElementById("toggleCaseBtn").addEventListener("click",()=>{
  caseSensitive=!caseSensitive;
  document.getElementById("toggleCaseBtn").textContent="Case: "+(caseSensitive?"ON":"OFF");
});

// === Label, Fade, Comment with persistence ===
function saveState(idx,state){
  let data=JSON.parse(localStorage.getItem("resultsState")||"{}");
  data[idx]=state;
  localStorage.setItem("resultsState",JSON.stringify(data));
}
function loadState(idx){
  let data=JSON.parse(localStorage.getItem("resultsState")||"{}");
  return data[idx]||{label:false,fade:false,comments:[]};
}
function updateSummary(){
  let data=JSON.parse(localStorage.getItem("resultsState")||"{}");
  let labeled=[],faded=[],commented=[];
  Object.keys(data).forEach(i=>{
    if(data[i].label) labeled.push(mainResults[i]);
    if(data[i].fade) faded.push(mainResults[i]);
    if(data[i].comments.length) commented.push(mainResults[i]+": "+data[i].comments.join("; "));
  });
  document.getElementById("labelSummary").textContent=labeled.join(" | ");
  document.getElementById("fadeSummary").textContent=faded.join(" | ");
  document.getElementById("commentSummary").textContent=commented.join(" | ");
}

document.getElementById("resultList").addEventListener("click",e=>{
  const li=e.target.closest("li"); if(!li) return;
  const idx=li.dataset.index; let state=loadState(idx);
  if(e.target.classList.contains("btn-copy")){
    navigator.clipboard.writeText(mainResults[idx]);
  } else if(e.target.classList.contains("btn-label")){
    state.label=!state.label; saveState(idx,state); renderList([...document.querySelectorAll("#resultList li")].map(x=>+x.dataset.index));
  } else if(e.target.classList.contains("btn-fade")){
    state.fade=!state.fade; saveState(idx,state); renderList([...document.querySelectorAll("#resultList li")].map(x=>+x.dataset.index));
  } else if(e.target.classList.contains("btn-comment")){
    let c=prompt("Enter comment:"); if(c){state.comments.push(c); saveState(idx,state); renderList([...document.querySelectorAll("#resultList li")].map(x=>+x.dataset.index));}
  }
});



</script>

<!-- Modal Popup -->
<div id="popup" class="popup-overlay hidden">
  <div class="popup-content">
    <button class="popup-close">&times;</button>
    <div id="popupSentence"></div>
    <div class="popup-nav">
      <button id="popupPrev">&larr; Prev</button>
      <button id="popupNext">Next &rarr;</button>
    </div>
  </div>
</div>

<script>
let currentPopupIdx = null;

// buka popup
document.addEventListener("click", e => {
  if (e.target.classList.contains("btn-view")) {
    const idx = parseInt(e.target.closest("li").dataset.index, 10);
    openPopup(idx);
  }
  if (e.target.classList.contains("popup-close") ||
      e.target.classList.contains("popup-overlay")) {
    closePopup();
  }
});

function openPopup(idx) {
  currentPopupIdx = idx;
  document.getElementById("popupSentence").textContent = mainResults[idx];
  document.getElementById("popup").classList.remove("hidden");
}

function closePopup() {
  document.getElementById("popup").classList.add("hidden");
  currentPopupIdx = null;
}

// navigasi prev/next
document.getElementById("popupPrev").addEventListener("click", () => {
  if (currentPopupIdx > 0) openPopup(currentPopupIdx - 1);
});
document.getElementById("popupNext").addEventListener("click", () => {
  if (currentPopupIdx < mainResults.length - 1) openPopup(currentPopupIdx + 1);
});

</script>
</body>
</html>
